{% extends "base.html" %}
{% block title %}Editar Resultado #{{ result.id }}{% endblock %}
{% block content %}

<div class="container mt-4">
  <h2 class="fw-bold text-primary mb-4">Editar Resultado</h2>

  <!-- IMPORTANTE: ahora soporta archivos -->
  <form method="POST" enctype="multipart/form-data">
    <div class="row g-3">

       <!-- Estado -->
        <div class="col-md-6">
            <label class="form-label" for="estado_prueba">Estado</label>
            <select id="estado_prueba" class="form-select" name="estado_prueba" required>
            {% for estado in ['pasado', 'fallido', 'bloqueado', 'en_progreso'] %}
                <option value="{{ estado }}" {% if result.estado_prueba.value == estado %}selected{% endif %}>
                {{ estado|replace('_', ' ')|title }}
                </option>
            {% endfor %}
            </select>
        </div>

        <!-- Entorno -->
        <div class="col-md-6">
            <label class="form-label" for="entorno">Entorno</label>
            <input type="text" id="entorno" class="form-control" name="entorno" value="{{ result.entorno or '' }}">
        </div>

        <!-- Usuario -->
        <div class="col-md-6">
            <label class="form-label" for="usu_created">Usuario</label>
            <input type="text" id="usu_created" class="form-control" name="usu_created"
                value="{{ result.usu_created or (current_user.nombre if current_user else '') }}">
        </div>

        <!-- Resultado obtenido -->
        <div class="col-12">
            <label class="form-label" for="resultado_obtenido">Resultado obtenido</label>
            <textarea id="resultado_obtenido" class="form-control" name="resultado_obtenido" rows="2">{{ result.resultado_obtenido or '' }}</textarea>
        </div>

        <!-- Notas -->
        <div class="col-12">
            <label class="form-label" for="notas">Notas / Observaciones</label>
            <textarea id="notas" class="form-control" name="notas" rows="2">{{ result.notas or '' }}</textarea>
        </div>

        <!-- Archivo -->
        <div class="col-12">
            <label for="evidencia"class="form-label">Evidencia adjunta</label>
            {% if result.archivo %}
                <a href="{{ url_for('uploads.serve', filename=result.archivo) }}" target="_blank">
                    <img src="{{ url_for('uploads.serve', filename=result.archivo) }}" alt="Archivo" style="max-width:150px;">
                </a>
            {% endif %}
            <input type="file" name="archivo" class="form-control">
            <small class="text-muted">Puedes subir una imagen, captura o evidencia del test.</small>
        </div>

    </div>

    <div class="mt-4 d-flex justify-content-end gap-2">
      <button type="submit" name="delete" value="1" class="btn btn-danger"
              onclick="return confirm('Â¿Seguro que deseas eliminar este resultado?');">
        Eliminar
      </button>

      <a href="{{ url_for('test_bp.show', id=result.test_case_id) }}" class="btn btn-secondary">
        Cancelar
      </a>

      <button type="submit" class="btn btn-primary">Guardar Cambios</button>
    </div>
  </form>
</div>

{% endblock %}
